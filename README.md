# PR Reviewer Service

Микросервис для автоматического назначения ревьюеров на Pull Requests с системой управления командами и пользователями.

## Функциональность

### Основные возможности
- Автоматическое назначение ревьюеров (до 2 активных пользователей из команды автора)
- Переназначение ревьюеров в рамках команды заменяемого ревьюера
- Управление командами и пользователями
- Блокировка изменений после мержа PR
- Идемпотентная операция мержа

### Дополнительные возможности
- Эндпоинт статистики назначений (`/stats/assignments`)
- Массовая деактивация пользователей команды с переназначением открытых PR
- Интеграционные тесты с полным покрытием API
- Конфигурация линтера для контроля качества кода
- Нагрузочное тестирование с использованием K6

## Технический стек

- **Язык**: Go 1.21+
- **База данных**: PostgreSQL 15
- **Контейнеризация**: Docker + Docker Compose
- **Документация API**: OpenAPI 3.0

## Быстрый старт

### Запуск через Docker Compose

```bash
# Сборка и запуск сервиса
docker-compose up --build

# Применение миграций БД (первый запуск)
docker-compose exec db psql -U postgres -d prservice -f /migrations/001_init.sql
```

## API Endpoints

### Управление командами
- `POST /team/add` - Создание команды с участниками
- `GET /team/get?team_name=name` - Получение информации о команде

### Управление пользователями
- `POST /users/setIsActive` - Установка флага активности пользователя
- `GET /users/getReview?user_id=id` - Получение списка PR, назначенных пользователю

### Управление Pull Requests
- `POST /pullRequest/create` - Создание PR с автоматическим назначением ревьюеров
- `POST /pullRequest/merge` - Мерж PR (идемпотентная операция)
- `POST /pullRequest/reassign` - Переназначение ревьюера

### Дополнительные endpoints
- `GET /stats/assignments` - Статистика назначений по пользователям и PR
- `POST /team/{name}/deactivate` - Массовая деактивация пользователей команды

## Тестирование

```bash
# Запуск unit-тестов
make test

# Запуск интеграционных тестов
go test -v ./internal/api/

# Нагрузочное тестирование
make load-test
```

## Особенности реализации

### Автоназначение ревьюеров
- Назначаются до 2 активных пользователей из команды автора
- Автор исключается из списка кандидатов
- Если доступных кандидатов меньше двух, назначается доступное количество

### Безопасность операций
- Изменения в MERGED PR запрещены
- Массовая деактивация автоматически переназначает ревьюеров в открытых PR
- Все операции идемпотентны где это требуется

### Производительность
- Поддержка умеренных объемов данных (до 20 команд, 200 пользователей)
- Целевые метрики: 5 RPS, 300ms response time, 99.9% успешности

## Принятые решения

1. **Использование строковых идентификаторов** - соответствие OpenAPI спецификации
2. **Ручное применение миграций** - упрощение процесса развертывания
3. **Полная реализация дополнительных заданий** - все 5 дополнительных функций реализованы и протестированы
